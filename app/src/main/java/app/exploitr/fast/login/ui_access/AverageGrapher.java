package app.exploitr.fast.login.ui_access;

import android.os.Handler;
import android.widget.TextView;

import java.lang.ref.WeakReference;

import app.exploitr.fast.login.utils.Logger;

class AverageGrapher {

    private static AverageGrapher instance;
    private static WeakReference<TextView> pingAvg;
    private static int totalValue = 0;
    private static int count = 0;
    private Handler handler;
    private static boolean stop;
    private Runnable runnable;
    /*fix for value repetition*/
    private int previousValue = 0;

    private AverageGrapher(WeakReference<TextView> pingAvgVal) {
        pingAvg = pingAvgVal;
    }

    static AverageGrapher inited_Already() {
        return instance;
    }

    static AverageGrapher init(WeakReference<TextView> pingAvgVal) {
        instance = new AverageGrapher(pingAvgVal);
        return instance;
    }

    AverageGrapher putValue(int x) {
        if (MainActivity.isActive && previousValue != x) {
            totalValue += x;
            count++;
            if (count >= 250) {
                totalValue = totalValue / count;
                count = 1;
            }
            previousValue = x;
        }
        return this;
    }


    void draw() {
        handler = new Handler();
        runnable = new Runnable() {
            @Override
            public void run() {
                if (totalValue != 0 && count != 0 && pingAvg != null && MainActivity.isActive) {
                    if (pingAvg.get() != null) {
                        String paw = "Ping = " + totalValue / count + " ms";
                        pingAvg.get().setText(paw);
                    }
                }
                if (!stop) {
                    handler.postDelayed(this, 2000);
                }
            }
        };
        handler.post(runnable);
    }

    void destroy() {
        stop = true;
        totalValue = 0;
        count = 0;
        handler.removeCallbacks(runnable);
    }
}